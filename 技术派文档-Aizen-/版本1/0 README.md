---
typora-root-url: ..\images
---

### 1 前言

下面是基础的业务需求，由简单的Spring Boot+MySQL实现。

技术派是一个社区项目，本质上是任何用户都可以发布帖子（博客），然后其余用户观看和评论。具体设计下面的模块：

-   用户模块：主要做用户的信息管理，包括用户的基本信息、注册登陆。
-   文章模块：主要做文章的信息管理，包括文章的基本信息、文章的审查。
-   评论模块：主要做文章的评论的信息管理，包括文章的的基本信息。
-   消息模块：主要做交互的消息管理，包括用户-用户和系统-用户，消息发送和通知。
-   通用模块：主要做整个网站运营的其他需求，包括阅读计数、pv/uv、全局字典、图片上传、文章搜索等。

技术派分成了几个模块：

-   api：这个模块主要是设计PO类，例如DO（Domain Object，领域对象）。这些类打包后，给其他模块导入，这样可以为后续的微服务开道。
-   core：这个模块主要是做工具配置，例如缓存的配置、线程池的配置、IP分析的配置等等。
-   service：这个模块是做功能的实现逻辑，里面会用到api内部的PO类和core中的工具。
-   ui：这个是基于jsp的模块，就把它看作是一个前端项目即可。ps：后端人员无需看这一部分。
-   web：这个模块是开辟HTTP接口的模块，接受客户端的请求，然后处理逻辑。

下面抽象模型：

![image-20240318162954383](/../images/image-20240318162954383.png)



**除了业务的增删改查（Create Retrieve Update Delete，下面简称CRUD）**，下面为每个模块具体探讨。

### 2 用户模块

#### 2.1 注册登录

**需求**：用户的注册和登录账号。

**数据表**：user表

**实现逻辑**：

- 用户名+密码

- 微信公众号+验证码+SSE长链接


#### 2.2 权限管理

**需求**：某些操作需要权限，执行前获取用户的权限，然后鉴权决定是否放行。

**数据表**：user_info表

**实现逻辑**：

-   token内部存储用户id。
-   使用Filter分析token，获取用户id，然后用户id从获取数据库的用户信息（包括权限），放入ThreadLocal中。
-   面对需要权限的接口，使用Interceptor拦截器过滤。

#### 2.3 订阅关注

**需求**：用户关注某些博主。

**数据表**：user_relation表

**实现逻辑**：

-   CRUD

#### 2.4 用户轨迹

**需求**：记录用户的“阅读/收藏/点赞”“文章/评论”，用于记录信息。

**数据表**：user_foot表

**实现逻辑**：

1.  当用户触发某些事件时，通过事件监听机制，将事件放入线程池中异步添加。
2.  下游业务（即监听器）对事件做出响应。

### 3 文章模块

#### 3.1 文章设计

**需求**：将文章分为元信息和文章内容，能够保证文章的版本变化。

**数据表**：article表、article_detail表

**实现逻辑**：

-   CRUD

**需求**：将文章分类为不同的类型，方便推荐。文章元信息内部自带文章分类。每个文章只能有一个分类。

**数据表**：category表

**实现逻辑**：

-   CRUD

**需求**：文章带有不同的标签，方便推荐。每个文章可以包含多个标签。

**数据表**：tag表、artical_tag表

**实现逻辑**：

-   CRUD

#### 3.2 文章发布

**需求**：用户发布文章，需要先通过图片转链，然后上传，审核，公开。

**数据表**：article表

**实现逻辑**：

1.  图片转链
2.  创建文章（审核状态）
3.  文章公开（公开状态）

#### 3.3 专栏

**需求**：专栏为多个文章的集合，方便统一管理和使用。

**数据表**：column_info表、column_article表

**实现逻辑**：

-   CRUD

### 4 评论模块

#### 4.1 评论内容

**需求**：获取某个文章的评论内容。

**数据表**：comment表

**实现逻辑**：

-   CRUD

#### 4.2 评论点赞

**需求**：获取某个评论的点赞量。

**数据表**：user_foot表

**实现逻辑**：

-   直接使用count函数即可。

### 5 消息模块

#### 5.1 消息内容

**需求**：获取某个用户的消息内容。

**数据表**：notify_msg表

**实现逻辑**：

-   CRUD

#### 5.2 消息发布

**需求**：当需要向目标用户发送消息时，对目标用户是无感的。

**数据表**：notify_msg表、user_foot表

**实现逻辑**：

-   当触发用户触发事件时，通过事件监听机制，采用线程池异步添加信息。

### 6 通用模块

#### 6.1 阅读计数

**需求**：文章/评论的阅读量计数。

**数据表**：read_count表

**实现逻辑**：

-   当文章被请求时，通过事件监听机制，采用线程池异步增加阅读量
-   获取时，返回阅读量即可。

#### 6.2 pv/uv

**需求**：获取网站的Page View/User View

**数据表**：request_count表

**实现逻辑**：

-   在Filter层进行拦截，对根据用户信息进行计数

#### 6.3 全局字典

**需求**：网站的一些证书或者说明需要灵活修改，放入到数据库中即可查询

**数据表**：dict_common

**实现逻辑**：

-   CRUD

#### 6.4 图片上传

**需求**：博客上传之后，需要转链对应的图片，然后将图片下载

**数据表**：磁盘存储

**实现逻辑**：

1.  安全校验
2.  保存

#### 6.5 搜索

**需求**：使用文本搜索title，提供推荐内容

**数据表**：article表

**实现逻辑**：

-   使用数据库模糊查询。

